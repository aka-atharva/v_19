(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{3667:(e,s,t)=>{Promise.resolve().then(t.bind(t,2043))},2043:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eb});var a=t(5155),r=t(425),i=t(4110),n=t(2115),l=t(8173),o=t.n(l),d=t(602),c=t(6062),m=t(2823),u=t(6745),x=t(2640),h=t(8236),p=t(7364),g=t(1069),f=t(6046);async function b(){try{let e="http://localhost:9595/api",s=localStorage.getItem("token"),t={Authorization:"Bearer ".concat(s),Accept:"application/json","Content-Type":"application/json"},a=await fetch("".concat(e,"/admin/stats"),{headers:t}),r=await fetch("".concat(e,"/admin/users"),{headers:t}),i=[];try{let s=new Date().getTime(),a=await fetch("".concat(e,"/admin/activity?limit=50&_t=").concat(s),{headers:t});if(!a.ok)throw Error("Failed to fetch activity logs: ".concat(a.statusText));i=await a.json(),console.log("Fetched activity data:",i),i=i.map(e=>({...e,username:e.username||"anonymous"}))}catch(e){console.error("Error fetching activity logs:",e),i=[{id:1,action:"User login",username:"admin",timestamp:new Date().toISOString(),details:"Activity log system initialized with fallback data",page_url:null}]}let n=await fetch("".concat(e,"/admin/settings"),{headers:t});if(!a.ok||!r.ok||!n.ok)throw Error("Failed to fetch admin data");let l=await a.json(),o=await r.json(),d=await n.json();return{stats:l,users:o,activity:i,systemSettings:d}}catch(e){return console.error("Error fetching admin data:",e),{stats:{total_users:42,active_users:38,researchers:15,regular_users:26,system_uptime:"3 days, 7 hours",database_size:"42.5 MB"},users:[{id:1,username:"admin",email:"admin@example.com",role:"admin",is_active:!0,created_at:new Date().toISOString()},{id:2,username:"researcher",email:"researcher@example.com",role:"researcher",is_active:!0,created_at:new Date(Date.now()-864e5).toISOString()},{id:3,username:"user",email:"user@example.com",role:"user",is_active:!0,created_at:new Date(Date.now()-1728e5).toISOString()}],activity:[{id:1,action:"Login",username:"admin",timestamp:new Date().toISOString(),details:"User admin logged in successfully",page_url:null},{id:2,action:"Page visit",username:"researcher",timestamp:new Date(Date.now()-9e5).toISOString(),details:"Visited dashboard page",page_url:"/datapuur/dashboard"},{id:3,action:"Failed login attempt",username:"unknown",timestamp:new Date(Date.now()-18e5).toISOString(),details:"Invalid credentials",page_url:null}],systemSettings:{maintenance_mode:!1,debug_mode:!0,api_rate_limiting:!0,last_backup:new Date(Date.now()-864e5).toISOString()}}}}async function j(e){try{let s=localStorage.getItem("token"),t=await fetch("".concat("http://localhost:9595/api","/admin/users"),{method:"POST",headers:{Authorization:"Bearer ".concat(s),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.detail||"Failed to create user")}let a=await t.json();return a.created_at||(a.created_at=new Date().toISOString()),a}catch(e){throw console.error("Error creating user:",e),e}}async function v(e,s){try{let t=localStorage.getItem("token"),a=await fetch("".concat("http://localhost:9595/api","/admin/users/").concat(e),{method:"PUT",headers:{Authorization:"Bearer ".concat(t),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok){let e=await a.json();throw Error(e.detail||"Failed to update user")}return await a.json()}catch(e){throw console.error("Error updating user:",e),e}}async function y(e){try{let s=localStorage.getItem("token"),t=await fetch("".concat("http://localhost:9595/api","/admin/users/").concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(s),Accept:"application/json","Content-Type":"application/json"}});if(!t.ok){let e=await t.json();throw Error(e.detail||"Failed to delete user")}return}catch(e){throw console.error("Error deleting user:",e),e}}async function N(e,s){try{let t=localStorage.getItem("token"),a=await fetch("".concat("http://localhost:9595/api","/admin/settings"),{method:"PUT",headers:{Authorization:"Bearer ".concat(t),Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({[e]:s})});if(!a.ok){let e=await a.json();throw Error(e.detail||"Failed to update system setting")}return await a.json()}catch(e){throw console.error("Error updating system setting:",e),e}}async function w(){try{let e=localStorage.getItem("token"),s=await fetch("".concat("http://localhost:9595/api","/admin/backup"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),Accept:"application/json","Content-Type":"application/json"}});if(!s.ok){let e=await s.json();throw Error(e.detail||"Failed to run backup")}return await s.json()}catch(e){throw console.error("Error running backup:",e),e}}async function k(){try{let e=localStorage.getItem("token"),s=await fetch("".concat("http://localhost:9595/api","/admin/export-data"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),Accept:"application/json","Content-Type":"application/json"}});if(!s.ok){let e=await s.json();throw Error(e.detail||"Failed to export data")}return await s.json()}catch(e){throw console.error("Error exporting data:",e),e}}async function A(e){try{let s=localStorage.getItem("token"),t=await fetch("".concat("http://localhost:9595/api","/admin/activity/clear").concat(e?"?days=".concat(e):""),{method:"DELETE",headers:{Authorization:"Bearer ".concat(s),Accept:"application/json","Content-Type":"application/json"}});if(!t.ok){let e=await t.json();throw Error(e.detail||"Failed to clear activity logs")}return}catch(e){throw console.error("Error clearing activity logs:",e),e}}async function C(){try{let e=localStorage.getItem("token"),s=await fetch("".concat("http://localhost:9595/api","/admin/cleanup-data"),{method:"POST",headers:{Authorization:"Bearer ".concat(e),Accept:"application/json","Content-Type":"application/json"}});if(!s.ok){let e=await s.json();throw Error(e.detail||"Failed to cleanup data")}return await s.json()}catch(e){throw console.error("Error cleaning up data:",e),e}}var S=t(5472);let _=(0,t(9827).v)((e,s)=>({loading:!0,setLoading:s=>e({loading:s}),error:null,setError:s=>e({error:s}),notification:null,setNotification:s=>e({notification:s}),stats:null,setStats:s=>e({stats:s}),users:[],setUsers:s=>e({users:s}),activity:[],setActivity:s=>e({activity:s}),systemSettings:null,setSystemSettings:s=>e({systemSettings:s}),roles:[{id:1,name:"admin",description:"Full access to all system features and settings.",permissions:["user_management","system_settings","data_management","activity_logs"]},{id:2,name:"researcher",description:"Access to research tools and data analysis features.",permissions:["datapuur","kginsights","data_management"]},{id:3,name:"user",description:"Basic access to application features.",permissions:["view_reports","personal_settings"]},{id:4,name:"view",description:"View-only access to application features.",permissions:["view_reports"]}],setRoles:s=>e({roles:s}),availablePermissions:[{id:"user_management",name:"User Management"},{id:"system_settings",name:"System Settings"},{id:"data_management",name:"Data Management"},{id:"activity_logs",name:"Activity Logs"},{id:"datapuur",name:"DataPuur Access"},{id:"kginsights",name:"KGInsights Access"},{id:"view_reports",name:"View Reports"},{id:"personal_settings",name:"Personal Settings"}],setAvailablePermissions:s=>e({availablePermissions:s}),isProcessing:!1,setIsProcessing:s=>e({isProcessing:s}),addRoleIfNotExists:(t,a)=>{let{roles:r}=s();if(!r.some(e=>e.name===t)){let s={id:r.length+1,name:t,description:a||"Auto-created role: ".concat(t),permissions:["view_reports"]};e({roles:[...r,s]}),console.log("Added missing role: ".concat(t))}}}));var E=t(1476);function F(){let{stats:e,activity:s}=_(),t={hidden:{opacity:0,y:20},show:{opacity:1,y:0}};return e?(0,a.jsxs)(d.P.div,{variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"show",className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-4",children:"System Overview"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)(d.P.div,{variants:t,whileHover:{scale:1.02},className:"bg-card/80 backdrop-blur-sm p-6 rounded-lg border border-border shadow-md hover:shadow-lg transition-shadow duration-300",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-foreground mb-4 flex items-center",children:[(0,a.jsx)(m.A,{className:"h-5 w-5 mr-2 text-primary"}),"User Statistics"]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Total Users:"}),(0,a.jsx)("span",{className:"text-foreground font-medium",children:(null==e?void 0:e.total_users)||0})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Active Users:"}),(0,a.jsx)("span",{className:"text-foreground font-medium",children:(null==e?void 0:e.active_users)||0})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Researchers:"}),(0,a.jsx)("span",{className:"text-foreground font-medium",children:(null==e?void 0:e.researchers)||0})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Regular Users:"}),(0,a.jsx)("span",{className:"text-foreground font-medium",children:(null==e?void 0:e.regular_users)||0})]})]})]}),(0,a.jsxs)(d.P.div,{variants:t,whileHover:{scale:1.02},className:"bg-card/80 backdrop-blur-sm p-6 rounded-lg border border-border shadow-md hover:shadow-lg transition-shadow duration-300",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-foreground mb-4 flex items-center",children:[(0,a.jsx)(E.A,{className:"h-5 w-5 mr-2 text-secondary"}),"System Status"]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Uptime:"}),(0,a.jsx)("span",{className:"text-foreground font-medium",children:(null==e?void 0:e.system_uptime)||"N/A"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Database Size:"}),(0,a.jsx)("span",{className:"text-foreground font-medium",children:(null==e?void 0:e.database_size)||"N/A"})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Status:"}),(0,a.jsx)("span",{className:"text-primary font-medium",children:"Operational"})]})]})]}),(0,a.jsxs)(d.P.div,{variants:t,whileHover:{scale:1.02},className:"bg-card/80 backdrop-blur-sm p-6 rounded-lg border border-border shadow-md hover:shadow-lg transition-shadow duration-300",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-foreground mb-4 flex items-center",children:[(0,a.jsx)(u.A,{className:"h-5 w-5 mr-2 text-primary"}),"Recent Activity"]}),s&&s.length>0?(0,a.jsx)("div",{className:"space-y-3",children:s.slice(0,3).map((e,s)=>(0,a.jsxs)(d.P.div,{variants:e,className:"text-sm p-2 rounded-md bg-background/50 hover:bg-background transition-colors",children:[(0,a.jsx)("div",{className:"text-foreground font-medium",children:e.action}),(0,a.jsxs)("div",{className:"text-muted-foreground text-xs",children:[new Date(e.timestamp).toLocaleString()," - ",e.username]})]},e.id||s))}):(0,a.jsx)("p",{className:"text-muted-foreground",children:"No recent activity"})]})]})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-4",children:"System Overview"}),(0,a.jsx)("div",{className:"bg-card/80 backdrop-blur-sm p-6 rounded-lg border border-border",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Loading system statistics..."})})]})}var D=t(7517),T=t(4085),R=t(1773),P=t(6217),I=t(767),U=t(9602);let O=P.bL;P.l9;let L=P.ZL;P.bm;let z=n.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(P.hJ,{ref:s,className:(0,U.cn)("fixed inset-0 z-50 bg-black/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...r})});z.displayName=P.hJ.displayName;let J=n.forwardRef((e,s)=>{let{className:t,children:r,...i}=e;return(0,a.jsxs)(L,{children:[(0,a.jsx)(z,{}),(0,a.jsxs)(P.UC,{ref:s,className:(0,U.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...i,children:[r,(0,a.jsxs)(P.bm,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,a.jsx)(I.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});J.displayName=P.UC.displayName;let $=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,U.cn)("flex flex-col space-y-1.5 text-center sm:text-left",s),...t})};$.displayName="DialogHeader";let B=e=>{let{className:s,...t}=e;return(0,a.jsx)("div",{className:(0,U.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...t})};B.displayName="DialogFooter";let M=n.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(P.hE,{ref:s,className:(0,U.cn)("text-lg font-semibold leading-none tracking-tight",t),...r})});M.displayName=P.hE.displayName,n.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(P.VY,{ref:s,className:(0,U.cn)("text-sm text-muted-foreground",t),...r})}).displayName=P.VY.displayName;var q=t(2336),V=t(5785),H=t(2581),Y=t(745);function G(e){let{open:s,onOpenChange:t,user:r}=e,{users:i,setUsers:l,isProcessing:o,setIsProcessing:d,setNotification:c,addRoleIfNotExists:m}=_(),[u,x]=(0,n.useState)({username:r.username,email:r.email,role:r.role,is_active:r.is_active}),{roles:h}=_();(0,n.useEffect)(()=>{r.role&&m(r.role)},[r.role,m]);let p=async()=>{d(!0);try{m(u.role);let e=await v(r.id,u);l(i.map(s=>s.id===e.id?e:s)),c({type:"success",message:"User ".concat(e.username," updated successfully")}),t(!1),setTimeout(()=>c(null),3e3)}catch(e){console.error("Error updating user:",e),c({type:"error",message:e.message||"Failed to update user"}),setTimeout(()=>c(null),3e3)}finally{d(!1)}};return(0,a.jsx)(O,{open:s,onOpenChange:t,children:(0,a.jsxs)(J,{className:"bg-card border border-border text-card-foreground",children:[(0,a.jsx)($,{children:(0,a.jsx)(M,{children:"Edit User"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V.J,{htmlFor:"username",children:"Username"}),(0,a.jsx)(q.p,{id:"username",value:u.username,onChange:e=>x({...u,username:e.target.value}),className:"bg-background border-input text-foreground",disabled:"admin"===r.username})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V.J,{htmlFor:"email",children:"Email"}),(0,a.jsx)(q.p,{id:"email",value:u.email,onChange:e=>x({...u,email:e.target.value}),className:"bg-background border-input text-foreground"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V.J,{htmlFor:"role",children:"Role"}),(0,a.jsxs)(Y.l6,{value:u.role,onValueChange:e=>x({...u,role:e}),disabled:"admin"===r.username,children:[(0,a.jsx)(Y.bq,{className:"bg-background border-input text-foreground",children:(0,a.jsx)(Y.yv,{placeholder:"Select a role"})}),(0,a.jsx)(Y.gC,{className:"bg-popover border border-border text-popover-foreground",children:h.map(e=>(0,a.jsx)(Y.eb,{value:e.name,children:e.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(H.d,{id:"is_active",checked:u.is_active,onCheckedChange:e=>x({...u,is_active:e}),disabled:"admin"===r.username}),(0,a.jsx)(V.J,{htmlFor:"is_active",children:"Active"})]})]}),(0,a.jsxs)(B,{children:[(0,a.jsx)(T.$,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(T.$,{className:"bg-violet-600 hover:bg-violet-700 text-white btn-glow",onClick:p,disabled:o,children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{className:"h-3 w-3 mr-1 animate-spin text-white"}),"Saving..."]}):"Save Changes"})]})]})})}function W(e){let{open:s,onOpenChange:t,user:r}=e,{users:i,setUsers:n,isProcessing:l,setIsProcessing:o,setNotification:d}=_(),c=async()=>{o(!0);try{await y(r.id),n(i.filter(e=>e.id!==r.id)),d({type:"success",message:"User ".concat(r.username," deleted successfully")}),t(!1),setTimeout(()=>d(null),3e3)}catch(e){console.error("Error deleting user:",e),d({type:"error",message:e.message||"Failed to delete user"}),setTimeout(()=>d(null),3e3)}finally{o(!1)}};return(0,a.jsx)(O,{open:s,onOpenChange:t,children:(0,a.jsxs)(J,{className:"bg-card border border-border text-card-foreground",children:[(0,a.jsx)($,{children:(0,a.jsx)(M,{children:"Delete User"})}),(0,a.jsxs)("div",{className:"py-4",children:[(0,a.jsxs)("p",{children:["Are you sure you want to delete user ",(0,a.jsx)("strong",{children:r.username}),"?"]}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"This action cannot be undone."})]}),(0,a.jsxs)(B,{children:[(0,a.jsx)(T.$,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(T.$,{className:"bg-destructive hover:bg-destructive/80 text-white",onClick:c,disabled:l,children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{className:"h-3 w-3 mr-1 animate-spin text-white"}),"Deleting..."]}):"Delete User"})]})]})})}function Z(e){let{open:s,onOpenChange:t}=e,{users:r,setUsers:i,isProcessing:l,setIsProcessing:o,setNotification:d,roles:c,addRoleIfNotExists:m}=_(),[u,x]=(0,n.useState)({username:"",email:"",password:"",role:"user",is_active:!0}),h=async()=>{if(!u.username||!u.email||!u.password){d({type:"error",message:"Please fill in all required fields"});return}m(u.role),o(!0);try{let e=await j(u);e.created_at||(e.created_at=new Date().toISOString()),i([...r,e]),d({type:"success",message:"User ".concat(e.username," created successfully")}),t(!1),x({username:"",email:"",password:"",role:"user",is_active:!0}),setTimeout(()=>d(null),3e3)}catch(e){console.error("Error adding user:",e),d({type:"error",message:e.message||"Failed to create user"}),setTimeout(()=>d(null),3e3)}finally{o(!1)}};return(0,a.jsx)(O,{open:s,onOpenChange:t,children:(0,a.jsxs)(J,{className:"bg-card border border-border text-card-foreground",children:[(0,a.jsx)($,{children:(0,a.jsx)(M,{children:"Add New User"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(V.J,{htmlFor:"username",children:["Username ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsx)(q.p,{id:"username",value:u.username,onChange:e=>x({...u,username:e.target.value}),className:"bg-background border-input text-foreground",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(V.J,{htmlFor:"email",children:["Email ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsx)(q.p,{id:"email",type:"email",value:u.email,onChange:e=>x({...u,email:e.target.value}),className:"bg-background border-input text-foreground",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(V.J,{htmlFor:"password",children:["Password ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsx)(q.p,{id:"password",type:"password",value:u.password,onChange:e=>x({...u,password:e.target.value}),className:"bg-background border-input text-foreground",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V.J,{htmlFor:"role",children:"Role"}),(0,a.jsxs)(Y.l6,{value:u.role,onValueChange:e=>x({...u,role:e}),children:[(0,a.jsx)(Y.bq,{className:"bg-background border-input text-foreground",children:(0,a.jsx)(Y.yv,{placeholder:"Select a role"})}),(0,a.jsx)(Y.gC,{className:"bg-popover border border-border text-popover-foreground",children:c.map(e=>(0,a.jsx)(Y.eb,{value:e.name,children:e.name},e.id))})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(H.d,{id:"is_active",checked:u.is_active,onCheckedChange:e=>x({...u,is_active:e})}),(0,a.jsx)(V.J,{htmlFor:"is_active",children:"Active"})]})]}),(0,a.jsxs)(B,{children:[(0,a.jsx)(T.$,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(T.$,{className:"bg-violet-600 hover:bg-violet-700 text-white btn-glow",onClick:h,disabled:l,children:l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{className:"h-3 w-3 mr-1 animate-spin text-white"}),"Creating..."]}):"Add User"})]})]})})}function K(e){let s=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(!e)return"N/A";try{let t="string"==typeof e?new Date(e):e;if(isNaN(t.getTime()))return"Invalid date";let a={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return s&&(a.second="2-digit"),t.toLocaleString("en-US",a)}catch(e){return console.error("Error formatting date:",e),"Error formatting date"}}function Q(e){if(!e)return"N/A";try{let s="string"==typeof e?new Date(e):e;if(isNaN(s.getTime()))return"Invalid date";let t=new Date,a=Math.floor((t.getTime()-s.getTime())/1e3);if(a<60)return"".concat(a," second").concat(1!==a?"s":""," ago");let r=Math.floor(a/60);if(r<60)return"".concat(r," minute").concat(1!==r?"s":""," ago");let i=Math.floor(r/60);if(i<24)return"".concat(i," hour").concat(1!==i?"s":""," ago");let n=Math.floor(i/24);if(n<30)return"".concat(n," day").concat(1!==n?"s":""," ago");let l=Math.floor(n/30);if(l<12)return"".concat(l," month").concat(1!==l?"s":""," ago");let o=Math.floor(l/12);return"".concat(o," year").concat(1!==o?"s":""," ago")}catch(e){return console.error("Error calculating relative time:",e),"Error calculating time"}}function X(){let{users:e}=_(),[s,t]=(0,n.useState)(!1),[r,i]=(0,n.useState)(!1),[l,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(null),m=e=>{c(e),t(!0)},u=e=>{c(e),i(!0)};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-foreground",children:"User Management"}),(0,a.jsxs)(T.$,{className:"bg-violet-600 hover:bg-violet-700 text-white btn-glow",onClick:()=>o(!0),children:[(0,a.jsx)(D.A,{className:"h-4 w-4 mr-2"}),"Add User"]})]}),(0,a.jsx)("div",{className:"bg-card p-4 rounded-lg border border-border overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-left",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-border",children:[(0,a.jsx)("th",{className:"p-3 text-muted-foreground",children:"ID"}),(0,a.jsx)("th",{className:"p-3 text-muted-foreground",children:"Username"}),(0,a.jsx)("th",{className:"p-3 text-muted-foreground",children:"Email"}),(0,a.jsx)("th",{className:"p-3 text-muted-foreground",children:"Role"}),(0,a.jsx)("th",{className:"p-3 text-muted-foreground",children:"Status"}),(0,a.jsx)("th",{className:"p-3 text-muted-foreground",children:"Created"}),(0,a.jsx)("th",{className:"p-3 text-muted-foreground",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:null==e?void 0:e.map(e=>(0,a.jsxs)("tr",{className:"border-b border-border hover:bg-accent/50",children:[(0,a.jsx)("td",{className:"p-3 text-card-foreground",children:e.id}),(0,a.jsx)("td",{className:"p-3 text-card-foreground",children:e.username}),(0,a.jsx)("td",{className:"p-3 text-card-foreground",children:e.email}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("admin"===e.role?"bg-purple-500 text-white":"researcher"===e.role?"bg-blue-500 text-white":"bg-gray-500 text-white"),children:e.role})}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(e.is_active?"bg-green-500 text-white":"bg-red-500 text-white"),children:e.is_active?"Active":"Inactive"})}),(0,a.jsx)("td",{className:"p-3 text-muted-foreground",children:e.created_at?K(e.created_at,!1):"N/A"}),(0,a.jsx)("td",{className:"p-3",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)(T.$,{variant:"outline",size:"sm",className:"border-violet-600 text-violet-600 hover:bg-violet-600/20 text-xs h-7",onClick:()=>m(e),children:"Edit"}),"admin"!==e.username&&(0,a.jsx)(T.$,{variant:"outline",size:"sm",className:"text-xs h-7 border-destructive text-destructive hover:bg-destructive/20",onClick:()=>u(e),children:"Delete"})]})})]},e.id))})]})}),s&&(0,a.jsx)(G,{open:s,onOpenChange:t,user:d}),r&&(0,a.jsx)(W,{open:r,onOpenChange:i,user:d}),(0,a.jsx)(Z,{open:l,onOpenChange:o})]})}var ee=t(4267),es=t(9993),et=t(1466),ea=t(6122);function er(){let{activity:e,setActivity:s,users:t,isProcessing:r,setIsProcessing:i,setNotification:l}=_(),[o,d]=(0,n.useState)(!1),[c,m]=(0,n.useState)(new Date),[u,x]=(0,n.useState)(10),[h,p]=(0,n.useState)(""),[g,f]=(0,n.useState)(""),[j,v]=(0,n.useState)(""),[y,N]=(0,n.useState)(!1),[w,k]=(0,n.useState)([]),[C,S]=(0,n.useState)([]),[E,F]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!o)return;let e=setInterval(()=>{D(!1),m(new Date)},1e3*u);return()=>clearInterval(e)},[o,u]),(0,n.useEffect)(()=>{e&&e.length>0&&(k([...new Set(e.map(e=>e.username))].filter(Boolean).sort()),S([...new Set(e.map(e=>e.action))].filter(Boolean).sort()),F([...new Set(e.map(e=>e.page_url).filter(Boolean))].sort()))},[e]),(0,n.useEffect)(()=>{if(e&&e.length>0){let t=e.map(e=>{if((!e.username||"system"===e.username)&&"Login"===e.action&&e.details){let s=e.details.match(/User (\w+) logged in/);if(s&&s[1])return console.log("Fixing username for login activity: ".concat(s[1])),{...e,username:s[1]}}return e});JSON.stringify(t)!==JSON.stringify(e)&&(console.log("Updating activity data with processed usernames"),s(t))}},[e,s]);let D=async function(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];e&&i(!0);try{let t=(await b()).activity.map(e=>({...e,formattedTime:K(e.timestamp),relativeTime:Q(e.timestamp)}));s(t),e&&(l({type:"success",message:"Activity logs refreshed successfully"}),setTimeout(()=>l(null),3e3))}catch(s){console.error("Error refreshing activity logs:",s),e&&l({type:"error",message:"Failed to refresh activity logs"})}finally{e&&i(!1)}},P=async()=>{if(confirm("Are you sure you want to clear old activity logs? This cannot be undone.")){i(!0);try{await A(30),l({type:"success",message:"Activity logs older than 30 days have been cleared"});let e=await b();s(e.activity)}catch(e){console.error("Error clearing logs:",e),l({type:"error",message:"Failed to clear activity logs"})}finally{i(!1)}}},I=e.filter(e=>{let s=!h||"all"===h||e.username===h,t=!g||"all"===g||e.action===g,a=!j||"all"===j||e.page_url&&e.page_url.includes(j);return s&&t&&a}),U=(()=>{let s={};return console.log("Activity data for summary:",e),e.forEach(e=>{if(!e.username){console.log("Skipping item with no username:",e);return}let t=e.username;console.log("Processing activity for user: ".concat(t,", action: ").concat(e.action)),s[t]||(s[t]={totalActions:0,pageVisits:0,loginCount:0,lastActive:null}),s[t].totalActions++,"Page visit"===e.action?s[t].pageVisits++:"Login"===e.action&&s[t].loginCount++;let a=new Date(e.timestamp);(!s[t].lastActive||a>new Date(s[t].lastActive))&&(s[t].lastActive=e.timestamp)}),console.log("Generated activity summary:",s),s})(),O=e=>{if(!e)return"N/A";try{let s=new Date(e);if(isNaN(s.getTime()))return"Invalid Date";return s.toLocaleString()}catch(e){return"Invalid Date"}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-foreground",children:"Activity Log"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsxs)("div",{className:"flex items-center mr-4",children:[(0,a.jsx)("input",{type:"checkbox",id:"auto-refresh",checked:o,onChange:e=>d(e.target.checked),className:"mr-2"}),(0,a.jsx)("label",{htmlFor:"auto-refresh",className:"text-sm text-muted-foreground",children:"Auto-refresh"})]}),o&&(0,a.jsxs)("div",{className:"flex items-center mr-4",children:[(0,a.jsx)("label",{htmlFor:"refresh-interval",className:"text-sm text-muted-foreground mr-2",children:"Every"}),(0,a.jsxs)("select",{id:"refresh-interval",value:u,onChange:e=>x(Number(e.target.value)),className:"bg-background border border-input rounded px-2 py-1 text-sm",children:[(0,a.jsx)("option",{value:"5",children:"5 sec"}),(0,a.jsx)("option",{value:"10",children:"10 sec"}),(0,a.jsx)("option",{value:"30",children:"30 sec"}),(0,a.jsx)("option",{value:"60",children:"1 min"})]})]}),(0,a.jsxs)(T.$,{variant:"outline",className:"border-violet-600 text-violet-600 hover:bg-violet-600/20",onClick:()=>N(!y),children:[(0,a.jsx)(ee.A,{className:"h-4 w-4 mr-2"}),y?"Hide Filters":"Show Filters"]}),(0,a.jsxs)(T.$,{variant:"outline",className:"border-violet-600 text-violet-600 hover:bg-violet-600/20",onClick:()=>D(),disabled:r,children:[(0,a.jsx)(R.A,{className:"h-4 w-4 mr-2 ".concat(r?"animate-spin":"")}),"Refresh"]}),(0,a.jsxs)(T.$,{variant:"outline",className:"border-destructive text-destructive hover:bg-destructive/20",onClick:P,disabled:r,children:[(0,a.jsx)(es.A,{className:"h-4 w-4 mr-2"}),"Clear Old Logs"]})]})]}),o&&(0,a.jsxs)("div",{className:"text-xs text-muted-foreground text-right",children:["Last refreshed: ",O(c)," (auto-refreshes every ",u," seconds)"]}),(0,a.jsxs)("div",{className:"bg-card/80 backdrop-blur-sm p-6 rounded-lg border border-border mb-6",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-foreground mb-4",children:"User Activity Summary"}),(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:Object.entries(U).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"bg-background/50 backdrop-blur-sm p-4 rounded-lg border border-border hover:shadow-md transition-shadow duration-200",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,a.jsx)(et.A,{className:"h-4 w-4 text-primary"}),(0,a.jsx)("span",{className:"font-medium text-foreground",children:s})]}),(0,a.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Total Actions:"}),(0,a.jsx)("span",{className:"text-foreground",children:t.totalActions})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Page Visits:"}),(0,a.jsx)("span",{className:"text-foreground",children:t.pageVisits})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-muted-foreground",children:"Last Active:"}),(0,a.jsx)("span",{className:"text-foreground",children:O(t.lastActive)})]})]})]},s)})})]}),y&&(0,a.jsx)("div",{className:"bg-card p-4 rounded-lg border border-border mb-4",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-1 block",children:"Filter by User"}),(0,a.jsxs)(Y.l6,{value:h,onValueChange:p,children:[(0,a.jsx)(Y.bq,{children:(0,a.jsx)(Y.yv,{placeholder:"All Users"})}),(0,a.jsxs)(Y.gC,{children:[(0,a.jsx)(Y.eb,{value:"all",children:"All Users"}),w.map(e=>(0,a.jsx)(Y.eb,{value:e,children:e},e))]})]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-1 block",children:"Filter by Action"}),(0,a.jsxs)(Y.l6,{value:g,onValueChange:f,children:[(0,a.jsx)(Y.bq,{children:(0,a.jsx)(Y.yv,{placeholder:"All Actions"})}),(0,a.jsxs)(Y.gC,{children:[(0,a.jsx)(Y.eb,{value:"all",children:"All Actions"}),C.map(e=>(0,a.jsx)(Y.eb,{value:e,children:e},e))]})]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"text-sm font-medium mb-1 block",children:"Filter by Page"}),(0,a.jsxs)(Y.l6,{value:j,onValueChange:v,children:[(0,a.jsx)(Y.bq,{children:(0,a.jsx)(Y.yv,{placeholder:"All Pages"})}),(0,a.jsxs)(Y.gC,{children:[(0,a.jsx)(Y.eb,{value:"all",children:"All Pages"}),E.map(e=>(0,a.jsx)(Y.eb,{value:e,children:e},e))]})]})]}),(0,a.jsx)(T.$,{variant:"outline",onClick:()=>{p(""),f(""),v("")},className:"mb-0",children:"Reset Filters"})]})}),(0,a.jsx)("div",{className:"bg-card p-4 rounded-lg border border-border",children:0===I.length?(0,a.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No activity logs found"}):(0,a.jsx)("div",{className:"space-y-4",children:I.map((e,s)=>(0,a.jsxs)("div",{className:"p-3 border-b border-border last:border-0",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("div",{className:"text-card-foreground font-medium ".concat("Login"===e.action?"text-violet-500":""),children:e.action||"Unknown Action"}),(0,a.jsxs)("div",{className:"text-muted-foreground text-sm flex items-center gap-2",children:[(0,a.jsx)("span",{children:O(e.timestamp)}),(0,a.jsxs)("span",{className:"text-xs opacity-70",children:["(",Q(e.timestamp),")"]})]})]}),(0,a.jsxs)("div",{className:"text-muted-foreground mt-1 flex items-center",children:[(0,a.jsx)(et.A,{className:"h-4 w-4 mr-1 ".concat("Login"===e.action?"text-violet-500":"")}),(0,a.jsx)("span",{className:"font-medium",children:e.username||"Anonymous"})]}),e.details&&(0,a.jsx)("div",{className:"text-muted-foreground text-sm mt-1",children:e.details}),e.page_url&&(0,a.jsxs)("div",{className:"text-violet-500 text-sm mt-1 flex items-center",children:[(0,a.jsx)(ea.A,{className:"h-3 w-3 mr-1"}),e.page_url]}),e.ip_address&&(0,a.jsxs)("div",{className:"text-muted-foreground text-xs mt-1",children:["IP: ",e.ip_address]})]},e.id||s))})}),I.length>0&&(0,a.jsxs)("div",{className:"text-center text-muted-foreground text-sm",children:["Showing ",I.length," of ",e.length," activities"]})]})}var ei=t(6352),en=t(8867);let el=n.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(ei.bL,{ref:s,className:(0,U.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",t),...r,children:(0,a.jsx)(ei.C1,{className:(0,U.cn)("flex items-center justify-center text-current"),children:(0,a.jsx)(en.A,{className:"h-4 w-4"})})})});function eo(e){let{open:s,onOpenChange:t,role:r}=e,{roles:i,setRoles:l,availablePermissions:o,isProcessing:d,setIsProcessing:c,setNotification:m}=_(),[u,x]=(0,n.useState)({id:r.id,name:r.name,description:r.description,permissions:[...r.permissions]}),h=e=>{x(s=>{let t=s.permissions.includes(e)?s.permissions.filter(s=>s!==e):[...s.permissions,e];return{...s,permissions:t}})},p=async()=>{if(!u.name){m({type:"error",message:"Role name is required"});return}c(!0);try{let e=i.map(e=>e.id===u.id?u:e);l(e),m({type:"success",message:'Role "'.concat(u.name,'" updated successfully')}),t(!1),setTimeout(()=>m(null),3e3)}catch(e){console.error("Error updating role:",e),m({type:"error",message:"Failed to update role"}),setTimeout(()=>m(null),3e3)}finally{c(!1)}};return(0,a.jsx)(O,{open:s,onOpenChange:t,children:(0,a.jsxs)(J,{className:"bg-card border border-border text-card-foreground",children:[(0,a.jsx)($,{children:(0,a.jsx)(M,{children:"Edit Role"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(V.J,{htmlFor:"name",children:["Role Name ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsx)(q.p,{id:"name",value:u.name,onChange:e=>x({...u,name:e.target.value}),className:"bg-background border-input text-foreground",disabled:"admin"===u.name||"researcher"===u.name||"user"===u.name,required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V.J,{htmlFor:"description",children:"Description"}),(0,a.jsx)(q.p,{id:"description",value:u.description,onChange:e=>x({...u,description:e.target.value}),className:"bg-background border-input text-foreground",placeholder:"Role description"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V.J,{children:"Permissions"}),(0,a.jsx)("div",{className:"space-y-2 border border-border rounded-md p-4 max-h-48 overflow-y-auto",children:o.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(el,{id:"permission-".concat(e.id),checked:u.permissions.includes(e.id),onCheckedChange:()=>h(e.id),disabled:"admin"===u.name&&"user_management"===e.id}),(0,a.jsx)(V.J,{htmlFor:"permission-".concat(e.id),className:"font-normal cursor-pointer",children:e.name})]},e.id))})]})]}),(0,a.jsxs)(B,{children:[(0,a.jsx)(T.$,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(T.$,{className:"bg-violet-600 hover:bg-violet-700 text-white btn-glow",onClick:p,disabled:d,children:d?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{className:"h-3 w-3 mr-1 animate-spin text-white"}),"Saving..."]}):"Save Changes"})]})]})})}function ed(e){let{open:s,onOpenChange:t}=e,{roles:r,setRoles:i,availablePermissions:l,isProcessing:o,setIsProcessing:d,setNotification:c}=_(),[m,u]=(0,n.useState)({name:"",description:"",permissions:[]}),x=e=>{u(s=>{let t=s.permissions.includes(e)?s.permissions.filter(s=>s!==e):[...s.permissions,e];return{...s,permissions:t}})},h=async()=>{if(!m.name){c({type:"error",message:"Role name is required"});return}if(r.some(e=>e.name.toLowerCase()===m.name.toLowerCase())){c({type:"error",message:'Role "'.concat(m.name,'" already exists')});return}d(!0);try{let e={id:r.length+1,...m};i([...r,e]),c({type:"success",message:'Role "'.concat(m.name,'" created successfully')}),t(!1),u({name:"",description:"",permissions:[]}),setTimeout(()=>c(null),3e3)}catch(e){console.error("Error adding role:",e),c({type:"error",message:e.message||"Failed to create role"}),setTimeout(()=>c(null),3e3)}finally{d(!1)}};return(0,a.jsx)(O,{open:s,onOpenChange:t,children:(0,a.jsxs)(J,{className:"bg-card border border-border text-card-foreground",children:[(0,a.jsx)($,{children:(0,a.jsx)(M,{children:"Add New Role"})}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(V.J,{htmlFor:"name",children:["Role Name ",(0,a.jsx)("span",{className:"text-destructive",children:"*"})]}),(0,a.jsx)(q.p,{id:"name",value:m.name,onChange:e=>u({...m,name:e.target.value}),className:"bg-background border-input text-foreground",placeholder:"e.g., editor",required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V.J,{htmlFor:"description",children:"Description"}),(0,a.jsx)(q.p,{id:"description",value:m.description,onChange:e=>u({...m,description:e.target.value}),className:"bg-background border-input text-foreground",placeholder:"Role description"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(V.J,{children:"Permissions"}),(0,a.jsx)("div",{className:"space-y-2 border border-border rounded-md p-4 max-h-48 overflow-y-auto",children:l.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(el,{id:"permission-".concat(e.id),checked:m.permissions.includes(e.id),onCheckedChange:()=>x(e.id)}),(0,a.jsx)(V.J,{htmlFor:"permission-".concat(e.id),className:"font-normal cursor-pointer",children:e.name})]},e.id))})]})]}),(0,a.jsxs)(B,{children:[(0,a.jsx)(T.$,{variant:"outline",onClick:()=>t(!1),children:"Cancel"}),(0,a.jsx)(T.$,{className:"bg-violet-600 hover:bg-violet-700 text-white btn-glow",onClick:h,disabled:o,children:o?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{className:"h-3 w-3 mr-1 animate-spin text-white"}),"Creating..."]}):"Add Role"})]})]})})}function ec(){let{roles:e,availablePermissions:s}=_(),[t,r]=(0,n.useState)(!1),[i,l]=(0,n.useState)(!1),[o,d]=(0,n.useState)(null),c=e=>{d(e),r(!0)};return(0,n.useEffect)(()=>{},[e]),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-foreground",children:"Role Management"}),(0,a.jsxs)(T.$,{className:"bg-violet-600 hover:bg-violet-700 text-white btn-glow",onClick:()=>l(!0),children:[(0,a.jsx)(D.A,{className:"h-4 w-4 mr-2"}),"Add Role"]})]}),(0,a.jsx)("p",{className:"text-muted-foreground mb-6",children:"Configure role-based permissions and access controls for your application."}),(0,a.jsx)("div",{className:"bg-card p-6 rounded-lg border border-border",children:(0,a.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,a.jsx)("div",{className:"p-4 border border-border rounded-lg",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-card-foreground font-medium mb-2",children:e.name}),(0,a.jsx)("p",{className:"text-muted-foreground text-sm mb-2",children:e.description}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:e.permissions.map(e=>{var t;return(0,a.jsx)("span",{className:"px-2 py-1 bg-accent rounded-md text-xs text-foreground",children:(null===(t=s.find(s=>s.id===e))||void 0===t?void 0:t.name)||e},e)})})]}),(0,a.jsx)(T.$,{variant:"outline",size:"sm",className:"border-violet-600 text-violet-600 hover:bg-violet-600/20 text-xs h-7",onClick:()=>c(e),children:"Edit Role"})]})},e.id))})}),t&&(0,a.jsx)(eo,{open:t,onOpenChange:r,role:o}),(0,a.jsx)(ed,{open:i,onOpenChange:l})]})}function em(){let{systemSettings:e,setSystemSettings:s,isProcessing:t,setIsProcessing:r,setNotification:i}=_(),n=async(e,t)=>{r(!0);try{let a=await N(e,t);s(a),i({type:"success",message:"".concat(e.replace(/_/g," ")," has been ").concat(t?"enabled":"disabled")}),setTimeout(()=>i(null),3e3)}catch(e){console.error("Error updating setting:",e),i({type:"error",message:"Failed to update setting"}),setTimeout(()=>i(null),3e3)}finally{r(!1)}},l=async()=>{r(!0);try{await w(),i({type:"success",message:"Backup process started"}),setTimeout(()=>{i(null)},3e3)}catch(e){console.error("Error starting backup:",e),i({type:"error",message:"Failed to start backup"}),setTimeout(()=>i(null),3e3)}finally{r(!1)}},o=async()=>{r(!0);try{await k(),i({type:"success",message:"Data export initiated"}),setTimeout(()=>i(null),3e3)}catch(e){console.error("Error exporting data:",e),i({type:"error",message:"Failed to export data"}),setTimeout(()=>i(null),3e3)}finally{r(!1)}},d=async()=>{r(!0);try{await C(),i({type:"success",message:"Data cleanup process started"}),setTimeout(()=>i(null),3e3)}catch(e){console.error("Error cleaning up data:",e),i({type:"error",message:"Failed to clean up data"}),setTimeout(()=>i(null),3e3)}finally{r(!1)}};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-4",children:"Settings"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-card p-6 rounded-lg border border-border",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-card-foreground mb-4",children:"System Settings"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 border-b border-border",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-card-foreground font-medium",children:"Maintenance Mode"}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs",children:"Temporarily disable access to the application"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(H.d,{id:"maintenance-mode",checked:(null==e?void 0:e.maintenance_mode)||!1,onCheckedChange:e=>n("maintenance_mode",e),disabled:t}),(0,a.jsx)(V.J,{htmlFor:"maintenance-mode",className:"sr-only",children:"Maintenance Mode"})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 border-b border-border",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-card-foreground font-medium",children:"Debug Mode"}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs",children:"Enable detailed error messages and logging"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(H.d,{id:"debug-mode",checked:(null==e?void 0:e.debug_mode)||!1,onCheckedChange:e=>n("debug_mode",e),disabled:t}),(0,a.jsx)(V.J,{htmlFor:"debug-mode",className:"sr-only",children:"Debug Mode"})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center p-3 border-b border-border",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-card-foreground font-medium",children:"API Rate Limiting"}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs",children:"Limit API requests per user"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(H.d,{id:"api-rate-limiting",checked:(null==e?void 0:e.api_rate_limiting)||!1,onCheckedChange:e=>n("api_rate_limiting",e),disabled:t}),(0,a.jsx)(V.J,{htmlFor:"api-rate-limiting",className:"sr-only",children:"API Rate Limiting"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-card p-6 rounded-lg border border-border",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-card-foreground mb-4",children:"Data Management"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-3 border-b border-border",children:[(0,a.jsx)("h4",{className:"text-card-foreground font-medium mb-2",children:"Database Backup"}),(0,a.jsxs)("p",{className:"text-muted-foreground text-xs mb-3",children:["Last backup:"," ",(null==e?void 0:e.last_backup)?new Date(e.last_backup).toLocaleString():"Never"]}),(0,a.jsx)(T.$,{className:"bg-violet-600 hover:bg-violet-700 text-white btn-glow text-xs py-1 h-8",onClick:l,disabled:t,children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{className:"h-3 w-3 mr-1 animate-spin text-white"}),"Running..."]}):"Run Backup Now"})]}),(0,a.jsxs)("div",{className:"p-3 border-b border-border",children:[(0,a.jsx)("h4",{className:"text-card-foreground font-medium mb-2",children:"Data Export"}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs mb-3",children:"Export system data for backup or migration"}),(0,a.jsx)(T.$,{className:"bg-violet-600 hover:bg-violet-700 text-white btn-glow text-xs py-1 h-8",onClick:o,disabled:t,children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{className:"h-3 w-3 mr-1 animate-spin text-white"}),"Exporting..."]}):"Export Data"})]}),(0,a.jsxs)("div",{className:"p-3 border-b border-border",children:[(0,a.jsx)("h4",{className:"text-card-foreground font-medium mb-2",children:"Data Cleanup"}),(0,a.jsx)("p",{className:"text-muted-foreground text-xs mb-3",children:"Remove old or unused data from the system"}),(0,a.jsx)(T.$,{className:"bg-violet-600 hover:bg-violet-700 text-white btn-glow text-xs py-1 h-8",onClick:d,disabled:t,children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(R.A,{className:"h-3 w-3 mr-1 animate-spin text-white"}),"Cleaning..."]}):"Cleanup Data"})]})]})]})]})]})}function eu(e){let{activeTab:s,loading:t,error:r}=e;return t?(0,a.jsx)("div",{className:"flex justify-center py-12",children:(0,a.jsx)(S.A,{})}):(0,a.jsxs)(a.Fragment,{children:[r&&(0,a.jsx)("div",{className:"bg-yellow-500/20 border border-yellow-500 text-yellow-700 dark:text-yellow-200 px-4 py-2 rounded-md mb-4",children:(0,a.jsx)("p",{children:r})}),"dashboard"===s&&(0,a.jsx)(F,{}),"users"===s&&(0,a.jsx)(X,{}),"activity"===s&&(0,a.jsx)(er,{}),"permissions"===s&&(0,a.jsx)(ec,{}),"settings"===s&&(0,a.jsx)(em,{})]})}el.displayName=ei.bL.displayName;var ex=t(3239),eh=t(1594);function ep(e){let{notification:s}=e;return(0,a.jsxs)(d.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-4 p-3 rounded-md flex items-center backdrop-blur-sm border ".concat("success"===s.type?"bg-primary/10 border-primary text-primary":"bg-destructive/10 border-destructive text-destructive"),children:["success"===s.type?(0,a.jsx)(ex.A,{className:"h-5 w-5 mr-2"}):(0,a.jsx)(eh.A,{className:"h-5 w-5 mr-2"}),(0,a.jsx)("p",{children:s.message})]})}function eg(){let{user:e}=(0,g.A)();!function(){let{logout:e}=(0,g.A)();(0,f.useRouter)()}();let[s,t]=(0,n.useState)("dashboard"),{loading:i,setLoading:l,error:j,setError:v,notification:y,setNotification:N,stats:w,setStats:k,users:A,setUsers:C,activity:E,setActivity:F,systemSettings:D,setSystemSettings:T,addRoleIfNotExists:R}=_();(0,n.useEffect)(()=>{(async()=>{l(!0);try{let e=await b();e&&(k(e.stats||{}),C(e.users||[]),F(e.activity||[]),T(e.systemSettings||{}),e.users&&e.users.length>0&&e.users.forEach(e=>{e.role&&R(e.role)})),v(null)}catch(e){console.error("Error fetching admin data:",e),v("Failed to load admin data. Using mock data instead.")}finally{l(!1)}})()},[]);let P=[{id:"dashboard",label:"Dashboard",icon:c.A},{id:"users",label:"Users",icon:m.A},{id:"activity",label:"Activity Log",icon:u.A},{id:"permissions",label:"Permissions",icon:x.A},{id:"settings",label:"Settings",icon:h.A}],I={hidden:{opacity:0,y:20},show:{opacity:1,y:0}};return(0,a.jsxs)("div",{className:"min-h-screen bg-background antialiased relative overflow-hidden",children:[(0,a.jsx)("div",{className:"h-full w-full absolute inset-0 z-0",children:(0,a.jsx)(r.n,{id:"tsparticlesfullpage",background:"transparent",minSize:.6,maxSize:1.4,particleDensity:100,className:"w-full h-full",particleColor:"var(--foreground)"})}),(0,a.jsxs)("div",{className:"relative z-10 pt-20 px-6 md:px-8",children:[(0,a.jsx)("div",{className:"max-w-7xl mx-auto relative",children:(0,a.jsxs)(o(),{href:"/",className:"absolute -top-12 left-0 z-20 flex items-center justify-center rounded-md bg-card/80 backdrop-blur-sm border border-border hover:bg-accent transition-colors duration-200 px-3 py-2 text-sm","aria-label":"Back to home",children:[(0,a.jsx)(p.A,{className:"w-4 h-4 text-foreground mr-2"}),(0,a.jsx)("span",{className:"text-foreground",children:"Back to Home"})]})}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsx)(d.P.h1,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-primary to-secondary",children:"Admin Dashboard"}),(0,a.jsx)(d.P.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"flex items-center",children:(0,a.jsx)("div",{className:"px-4 py-2 bg-card/80 backdrop-blur-sm rounded-lg border border-border",children:(0,a.jsxs)("span",{className:"text-foreground font-medium",children:["Welcome, ",(0,a.jsx)("span",{className:"text-primary font-bold",children:null==e?void 0:e.username})]})})})]}),y&&(0,a.jsx)(ep,{notification:y}),(0,a.jsxs)(d.P.div,{variants:{hidden:{opacity:0},show:{opacity:1,transition:{staggerChildren:.1}}},initial:"hidden",animate:"show",className:"bg-card/80 backdrop-blur-sm rounded-lg border border-border overflow-hidden shadow-md",children:[(0,a.jsx)("div",{className:"flex border-b border-border overflow-x-auto",children:P.map((e,r)=>(0,a.jsxs)(d.P.button,{variants:I,className:"flex items-center space-x-2 px-6 py-4 text-sm font-medium transition-colors whitespace-nowrap ".concat(s===e.id?"text-primary-foreground bg-primary border-b-2 border-primary":"text-muted-foreground hover:text-foreground hover:bg-accent"),onClick:()=>t(e.id),children:[(0,a.jsx)(e.icon,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:e.label})]},e.id))}),(0,a.jsxs)("div",{className:"p-6",children:[i&&(0,a.jsx)("div",{className:"flex justify-center py-12",children:(0,a.jsx)(S.A,{})}),!i&&(0,a.jsx)(eu,{activeTab:s,loading:i,error:j})]})]})]})]})]})}var ef=t(3726);function eb(){return(0,a.jsx)(ef.A,{requiredRole:"admin",children:(0,a.jsxs)("main",{className:"min-h-screen bg-background antialiased relative overflow-hidden",children:[(0,a.jsx)("div",{className:"h-full w-full absolute inset-0 z-0",children:(0,a.jsx)(r.n,{id:"tsparticlesfullpage",background:"transparent",minSize:.6,maxSize:1.4,particleDensity:100,className:"w-full h-full",particleColor:"var(--foreground)"})}),(0,a.jsxs)("div",{className:"relative z-10",children:[(0,a.jsx)(i.A,{}),(0,a.jsx)(eg,{})]})]})})}},5472:(e,s,t)=>{"use strict";t.d(s,{A:()=>i});var a=t(5155),r=t(602);function i(){return(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center",children:[(0,a.jsx)(r.P.div,{className:"w-16 h-16 border-4 border-primary border-t-transparent rounded-full shadow-[0_0_15px_rgba(26,35,126,0.3)]",animate:{rotate:360},transition:{duration:1,repeat:Number.POSITIVE_INFINITY,ease:"linear"}}),(0,a.jsx)("p",{className:"mt-4 text-foreground",children:"Loading data..."})]})}},3726:(e,s,t)=>{"use strict";t.d(s,{A:()=>o});var a=t(5155),r=t(1069),i=t(6046),n=t(2115),l=t(5472);function o(e){let{children:s,requiredRole:t}=e,{user:o,isLoading:d}=(0,r.A)(),c=(0,i.useRouter)(),m=(0,i.usePathname)();return((0,n.useEffect)(()=>{let e="true"===sessionStorage.getItem("isLoggingOut");d||o?!d&&o&&t&&"admin"!==o.role&&(("admin"!==t||"admin"===o.role)&&("researcher"!==t||["admin","researcher"].includes(o.role))||c.push("/")):e?(sessionStorage.removeItem("isLoggingOut"),c.push("/")):c.push("/login?redirect=".concat(encodeURIComponent(m)))},[o,d,c,m,t]),d)?(0,a.jsx)("div",{className:"min-h-screen bg-black/[0.96] flex items-center justify-center",children:(0,a.jsx)(l.A,{})}):t&&o&&"admin"!==o.role&&("admin"===t&&"admin"!==o.role||"researcher"===t&&!["admin","researcher"].includes(o.role))||!o?null:(0,a.jsx)(a.Fragment,{children:s})}},2336:(e,s,t)=>{"use strict";t.d(s,{p:()=>n});var a=t(5155),r=t(2115),i=t(9602);let n=r.forwardRef((e,s)=>{let{className:t,type:r,...n}=e;return(0,a.jsx)("input",{type:r,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",t),ref:s,...n})});n.displayName="Input"},5785:(e,s,t)=>{"use strict";t.d(s,{J:()=>d});var a=t(5155),r=t(2115),i=t(6195),n=t(6421),l=t(9602);let o=(0,n.F)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),d=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.b,{ref:s,className:(0,l.cn)(o(),t),...r})});d.displayName=i.b.displayName},745:(e,s,t)=>{"use strict";t.d(s,{bq:()=>u,eb:()=>g,gC:()=>p,l6:()=>c,yv:()=>m});var a=t(5155),r=t(2115),i=t(1848),n=t(1719),l=t(1902),o=t(8867),d=t(9602);let c=i.bL;i.YJ;let m=i.WT,u=r.forwardRef((e,s)=>{let{className:t,children:r,...l}=e;return(0,a.jsxs)(i.l9,{ref:s,className:(0,d.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",t),...l,children:[r,(0,a.jsx)(i.In,{asChild:!0,children:(0,a.jsx)(n.A,{className:"h-4 w-4 opacity-50"})})]})});u.displayName=i.l9.displayName;let x=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.PP,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(l.A,{className:"h-4 w-4"})})});x.displayName=i.PP.displayName;let h=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.wn,{ref:s,className:(0,d.cn)("flex cursor-default items-center justify-center py-1",t),...r,children:(0,a.jsx)(n.A,{className:"h-4 w-4"})})});h.displayName=i.wn.displayName;let p=r.forwardRef((e,s)=>{let{className:t,children:r,position:n="popper",...l}=e;return(0,a.jsx)(i.ZL,{children:(0,a.jsxs)(i.UC,{ref:s,className:(0,d.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===n&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",t),position:n,...l,children:[(0,a.jsx)(x,{}),(0,a.jsx)(i.LM,{className:(0,d.cn)("p-1","popper"===n&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(h,{})]})})});p.displayName=i.UC.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.JU,{ref:s,className:(0,d.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",t),...r})}).displayName=i.JU.displayName;let g=r.forwardRef((e,s)=>{let{className:t,children:r,...n}=e;return(0,a.jsxs)(i.q7,{ref:s,className:(0,d.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...n,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(i.VF,{children:(0,a.jsx)(o.A,{className:"h-4 w-4"})})}),(0,a.jsx)(i.p4,{children:r})]})});g.displayName=i.q7.displayName,r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.wv,{ref:s,className:(0,d.cn)("-mx-1 my-1 h-px bg-muted",t),...r})}).displayName=i.wv.displayName},2581:(e,s,t)=>{"use strict";t.d(s,{d:()=>l});var a=t(5155),r=t(2115),i=t(2413),n=t(9602);let l=r.forwardRef((e,s)=>{let{className:t,...r}=e;return(0,a.jsx)(i.bL,{className:(0,n.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",t),...r,ref:s,children:(0,a.jsx)(i.zi,{className:(0,n.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})})});l.displayName=i.bL.displayName}},e=>{var s=s=>e(e.s=s);e.O(0,[175,565,903,53,573,786,441,517,358],()=>s(3667)),_N_E=e.O()}]);